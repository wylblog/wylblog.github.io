<!DOCTYPE HTML><html lang="zh-CN"><style type="text/css" lang="css">#loading-container{position:fixed;top:0;left:0;min-height:100vh;width:100vw;z-index:9999;display:flex;flex-direction:column;justify-content:center;align-items:center;background:#fff;text-align:center;-webkit-transition:opacity 1s ease;-moz-transition:opacity 1s ease;-o-transition:opacity 1s ease;transition:opacity 1s ease}.loading-image{width:120px;height:50px;transform:translate(-50%)}.loading-image div:nth-child(2){-webkit-animation:pacman-balls 1s linear 0s infinite;animation:pacman-balls 1s linear 0s infinite}.loading-image div:nth-child(3){-webkit-animation:pacman-balls 1s linear .33s infinite;animation:pacman-balls 1s linear .33s infinite}.loading-image div:nth-child(4){-webkit-animation:pacman-balls 1s linear .66s infinite;animation:pacman-balls 1s linear .66s infinite}.loading-image div:nth-child(5){-webkit-animation:pacman-balls 1s linear .99s infinite;animation:pacman-balls 1s linear .99s infinite}.loading-image div:first-of-type{width:0;height:0;border:25px solid #49b1f5;border-right-color:transparent;border-radius:25px;-webkit-animation:rotate_pacman_half_up .5s 0s infinite;animation:rotate_pacman_half_up .5s 0s infinite}.loading-image div:nth-child(2){width:0;height:0;border:25px solid #49b1f5;border-right-color:transparent;border-radius:25px;-webkit-animation:rotate_pacman_half_down .5s 0s infinite;animation:rotate_pacman_half_down .5s 0s infinite;margin-top:-50px}@-webkit-keyframes rotate_pacman_half_up{0%{transform:rotate(270deg)}50%{transform:rotate(1turn)}to{transform:rotate(270deg)}}@keyframes rotate_pacman_half_up{0%{transform:rotate(270deg)}50%{transform:rotate(1turn)}to{transform:rotate(270deg)}}@-webkit-keyframes rotate_pacman_half_down{0%{transform:rotate(90deg)}50%{transform:rotate(0)}to{transform:rotate(90deg)}}@keyframes rotate_pacman_half_down{0%{transform:rotate(90deg)}50%{transform:rotate(0)}to{transform:rotate(90deg)}}@-webkit-keyframes pacman-balls{75%{opacity:.7}to{transform:translate(-100px,-6.25px)}}@keyframes pacman-balls{75%{opacity:.7}to{transform:translate(-100px,-6.25px)}}.loading-image div:nth-child(3),.loading-image div:nth-child(4),.loading-image div:nth-child(5),.loading-image div:nth-child(6){background-color:#49b1f5;width:15px;height:15px;border-radius:100%;margin:2px;width:10px;height:10px;position:absolute;transform:translateY(-6.25px);top:25px;left:100px}.loading-text{margin-bottom:20vh;text-align:center;color:#2c3e50;font-size:2rem;box-sizing:border-box;padding:0 10px;text-shadow:0 2px 10px rgba(0,0,0,.2)}@media only screen and (max-width:500px){.loading-text{font-size:1.5rem}}.fadeout{opacity:0}@-webkit-keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}100%{opacity:1;-webkit-transform:none;transform:none}}@keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0)}}</style><script>setTimeout(function(){let e=document.getElementById("loading-container");e.className="fadeout",setTimeout(function(){e.style.display="none"},1500)},800)</script><head><meta charset="utf-8"><meta name="keywords" content="Maxwell配置和基本使用, WuYiling&#39; Blog"><meta name="description" content="Maxwell1. Maxwell概述1.1 Maxwell定义​	Maxwell 是由美国 Zendesk 开源，用 Java 编写的 MySQL 实时抓取软件。 实时读取 MySQL 二进制日志 Binlog，并生成 JSON 格式的消"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="referrer" content="no-referrer-when-downgrade"><title>Maxwell配置和基本使用 | WuYiling&#39; Blog</title><link rel="icon" type="image/png" href="/medias/wylblog/avatar_wyl.webp"><link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css"><link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css"><link rel="stylesheet" type="text/css" href="/libs/aos/aos.css"><link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css"><link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" type="text/css" href="/css/matery.css"><link rel="stylesheet" type="text/css" href="/css/my.css"><link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload='"all"!=media&&(media="all")'><link rel="stylesheet" href="/libs/tocbot/tocbot.css"><link rel="stylesheet" href="/css/post.css"><link rel="stylesheet" type="text/css" href="/css/reward.css"><script src="/libs/jquery/jquery-3.6.0.min.js"></script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="loading-container"><p class="loading-text">嘘~ 正在从服务器偷取页面 . . . 可尝试再次刷新 . . .</p><div class="loading-image"><div></div><div></div><div></div><div></div><div></div></div></div><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img src="/medias/wylblog/avatar_wyl.webp" class="logo-img" alt="LOGO"> <span class="logo-span">WuYiling&#39; Blog</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fas fa-tags" style="zoom:.6"></i> <span>标签</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fas fa-bookmark" style="zoom:.6"></i> <span>分类</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fas fa-archive" style="zoom:.6"></i> <span>归档</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fas fa-address-book" style="zoom:.6"></i> <span>友链</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/about" class="waves-effect waves-light"><i class="fas fa-user-circle" style="zoom:.6"></i> <span>关于</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:.85"></i></a></li><li><a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式"><i id="sum-moon-icon" class="fas fa-sun" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="/medias/wylblog/avatar_wyl.webp" class="logo-img circle responsive-img"><div class="logo-name">WuYiling&#39; Blog</div><div class="logo-desc">本网站是个人兴趣爱好，总结分享经验，记录生活点滴的平台，希望在以后的学习旅途中，走出自己的风景。</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fa-fw fas fa-tags"></i> 标签</a></li><li class="m-nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fa-fw fas fa-bookmark"></i> 分类</a></li><li class="m-nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fa-fw fas fa-archive"></i> 归档</a></li><li class="m-nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fa-fw fas fa-address-book"></i> 友链</a></li><li class="m-nav-item"><a href="/about" class="waves-effect waves-light"><i class="fa-fw fas fa-user-circle"></i> 关于</a></li></ul></div></div></nav></header><script src="/libs/cryptojs/crypto-js.min.js"></script><script></script><div class="bg-cover pd-header post-cover" style="background-image:url(/medias/featureimages/12.webp)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">Maxwell配置和基本使用</h1></div></div></div></div></div><main class="post-container content"><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/Bigdata/"><span class="chip bg-color">Bigdata</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E8%BF%90%E7%BB%B4%E7%B3%BB%E5%88%97/" class="post-category">大数据运维系列</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp; 2024-11-27</div><div class="post-date info-break-policy"><i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp; 2024-11-27</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp; 4.3k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp; 18 分</div><div id="busuanzi_container_page_pv" class="info-break-policy"><i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp; <span id="busuanzi_value_page_pv"></span></div></div></div><hr class="clearfix"><link rel="stylesheet" href="/libs/prism/prism.min.css"><div class="card-content article-card-content"><div id="articleContent"><h1 id="Maxwell"><a href="#Maxwell" class="headerlink" title="Maxwell"></a>Maxwell</h1><h2 id="1-Maxwell概述"><a href="#1-Maxwell概述" class="headerlink" title="1. Maxwell概述"></a>1. Maxwell概述</h2><h3 id="1-1-Maxwell定义"><a href="#1-1-Maxwell定义" class="headerlink" title="1.1 Maxwell定义"></a>1.1 Maxwell定义</h3><p>​	Maxwell 是由美国 Zendesk 开源，用 Java 编写的 MySQL 实时抓取软件。 <code>实时读取 MySQL 二进制日志 Binlog</code>，并<code>生成 JSON 格式的消息</code>，作为生产者<code>发送给 Kafka</code>，Kinesis、 <code>RabbitMQ、Redis</code>、Google Cloud Pub&#x2F;Sub、文件或其它平台的应用程序。</p><p>官网:<a target="_blank" rel="noopener" href="https://maxwells-daemon.io/">Maxwell’s Daemon (maxwells-daemon.io)</a></p><h3 id="1-2-Maxwell-工作原理"><a href="#1-2-Maxwell-工作原理" class="headerlink" title="1.2 Maxwell 工作原理"></a>1.2 Maxwell 工作原理</h3><h4 id="1-2-1-MySQL主从复制过程"><a href="#1-2-1-MySQL主从复制过程" class="headerlink" title="1.2.1 MySQL主从复制过程"></a>1.2.1 MySQL主从复制过程</h4><p>过程:</p><ul><li>Master 主库将改变记录，写到二进制日志(binary log)中</li><li>Slave 从库向 mysql master 发送 dump 协议，将 master 主库的 binary log events 拷贝 到它的中继日志(relay log)；</li><li>Slave 从库读取并重做中继日志中的事件，将改变的数据同步到自己的数据库。</li></ul><p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401151006119.png" alt="image-20240115100615030"></p><h4 id="1-2-2-Maxwell-的工作原理"><a href="#1-2-2-Maxwell-的工作原理" class="headerlink" title="1.2.2 Maxwell 的工作原理"></a>1.2.2 Maxwell 的工作原理</h4><p>​	Maxwell 的工作原理很简单，就是把自己<code>伪装成 MySQL 的一个 slave</code>，然后以 slave 的身份假装从 MySQL(master)复制数据。</p><h4 id="1-2-3-MySQL-的-binlog"><a href="#1-2-3-MySQL-的-binlog" class="headerlink" title="1.2.3 MySQL 的 binlog"></a>1.2.3 MySQL 的 binlog</h4><blockquote><p>(1) 什么是 binlog</p></blockquote><p>​	MySQL 的二进制日志可以说 MySQL 最重要的日志了，它记录了所有的 DDL 和 DML(除 了数据查询语句)语句，以事件形式记录，还包含语句所执行的消耗的时间，MySQL 的二进 制日志是事务安全型的。</p><p>​	一般来说开启二进制日志大概会有 1%的性能损耗。二进制有两个最重要的使用场景:</p><ul><li>其一：MySQL Replication 在 Master 端开启 binlog，Master 把它的二进制日志传递 给 slaves 来达到 master-slave 数据一致的目的。</li><li>其二：自然就是数据恢复了，通过使用 mysqlbinlog 工具来使恢复数据。</li></ul><p>​	二进制日志包括两类文件：二进制日志索引文件（文件名后缀为.index）用于记录所有 的二进制文件，二进制日志文件（文件名后缀为.00000*）记录数据库所有的 DDL 和 DML(除 了数据查询语句)语句事件</p><blockquote><p>(2) binlog 的开启</p></blockquote><p>MySQL8.0以前没有开启。生产建议全部开启</p><p>配置方法：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@mysql01 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/my.cnf</span>
<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token assign-left variable">server_id</span><span class="token operator">=</span><span class="token number">3</span>   <span class="token comment">#前面设置了1，这个可以不设置</span>
<span class="token assign-left variable">log_bin</span><span class="token operator">=</span>/data/binlog/mysql-bin  	<span class="token comment">#binlog目录</span>
<span class="token assign-left variable">binlog_format</span><span class="token operator">=</span>row
<span class="token assign-left variable">sync_binlog</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">expire_logs_days</span><span class="token operator">=</span><span class="token number">30</span>
<span class="token assign-left variable">max_binlog_size</span><span class="token operator">=</span>100M<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>[mysqld]<br>server_id&#x3D;3 #(5.6可以不设置，5.7必须，是主从中应用)<br>log_bin&#x3D;&#x2F;data&#x2F;binlog&#x2F;mysql-bin #(日志位置和日志名前缀) 非常重要，差重选择存储目录<br>sync_binlog&#x3D;1 #（binlog日志刷盘的策略，每次事务提交立刻刷写到磁盘）<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/mycwq/article/details/17136997">binlog_format&#x3D;row</a> #binlog的日志记录格式为row模式(row模式会产生大量日志)（row相似debug）<br>expire_logs_days&#x3D;30 #设置binlog日志30天过期删除<br>max_binlog_size&#x3D;100M #设置binlog日志大小为100M (单个二进制日志 大小上限 默认1G ，到达自动切割日志)</p><p><strong>其中可以前往官网查看<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/replication-options-binary-log.html">5.7的文档</a>配置选项</strong></p><p>重启前创建binlog目录</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@mysql01 ~<span class="token punctuation">]</span><span class="token comment"># mkdir -p /data/binlog/</span>
<span class="token punctuation">[</span>root@mysql01 ~<span class="token punctuation">]</span><span class="token comment"># chown -R mysql.mysql /data/binlog/   #一定要给权限</span>
<span class="token punctuation">[</span>root@mysql01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart mysqld</span>
<span class="token punctuation">[</span>root@mysql01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl status mysqld</span>
<span class="token punctuation">[</span>root@mysql01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl status mysqld</span>
● mysqld.service - LSB: start and stop MySQL
   Loaded: loaded <span class="token punctuation">(</span>/etc/rc.d/init.d/mysqld<span class="token punctuation">;</span> bad<span class="token punctuation">;</span> vendor preset: disabled<span class="token punctuation">)</span>
   Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since 六 <span class="token number">2022</span>-03-05 <span class="token number">22</span>:48:20 CST<span class="token punctuation">;</span> 44s ago
   <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>略…..(MySQL知识自行复习以往笔记):</p><p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401151019661.png" alt="image-20240115101922588"></p><h2 id="2-Maxwell-使用"><a href="#2-Maxwell-使用" class="headerlink" title="2. Maxwell 使用"></a>2. Maxwell 使用</h2><blockquote><p><code>注意</code>: 要提前安装好 kafka 和 MySQL</p></blockquote><h3 id="2-1-安装地址"><a href="#2-1-安装地址" class="headerlink" title="2.1 安装地址"></a>2.1 安装地址</h3><p>（1）Maxwell 官网地址：<a target="_blank" rel="noopener" href="http://maxwells-daemon.io/">http://maxwells-daemon.io/</a></p><p>（2）文档查看地址：<a target="_blank" rel="noopener" href="http://maxwells-daemon.io/quickstart">http://maxwells-daemon.io/quickstart</a></p><h3 id="2-2-MySQL-环境准备"><a href="#2-2-MySQL-环境准备" class="headerlink" title="2.2  MySQL 环境准备"></a>2.2 MySQL 环境准备</h3><blockquote><p>(1) 修改 mysql 的配置文件，<code>开启 MySQL Binlog</code> 设置</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/my.cnf</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>添加如下内容:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401151603294.png"></p><p>修改后如下:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># grep -Ev "^$|^#" /etc/my.cnf</span>
<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token assign-left variable">datadir</span><span class="token operator">=</span>/var/lib/mysql
<span class="token assign-left variable">socket</span><span class="token operator">=</span>/var/lib/mysql/mysql.sock
symbolic-links<span class="token operator">=</span><span class="token number">0</span>
log-error<span class="token operator">=</span>/var/log/mysqld.log
pid-file<span class="token operator">=</span>/var/run/mysqld/mysqld.pid
<span class="token assign-left variable">server_id</span><span class="token operator">=</span><span class="token number">1</span>
log-bin<span class="token operator">=</span>mysql-bin
<span class="token assign-left variable">binlog_format</span><span class="token operator">=</span>row<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>重启MySQL服务</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart mysqld</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>登录 mysql 并查看是否修改完成</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%binlog%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------------+----------------------+</span>
<span class="token operator">|</span> Variable_name                              <span class="token operator">|</span> <span class="token keyword">Value</span>                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------------+----------------------+</span>
<span class="token operator">|</span> binlog_cache_size                          <span class="token operator">|</span> <span class="token number">32768</span>                <span class="token operator">|</span>
<span class="token operator">|</span> binlog_checksum                            <span class="token operator">|</span> CRC32                <span class="token operator">|</span>
<span class="token operator">|</span> binlog_direct_non_transactional_updates    <span class="token operator">|</span> <span class="token keyword">OFF</span>                  <span class="token operator">|</span>
<span class="token operator">|</span> binlog_error_action                        <span class="token operator">|</span> ABORT_SERVER         <span class="token operator">|</span>
<span class="token operator">|</span> binlog_format                              <span class="token operator">|</span> <span class="token keyword">ROW</span>                  <span class="token operator">|</span>
<span class="token operator">|</span> binlog_group_commit_sync_delay             <span class="token operator">|</span> <span class="token number">0</span>                    <span class="token operator">|</span>
<span class="token operator">|</span> binlog_group_commit_sync_no_delay_count    <span class="token operator">|</span> <span class="token number">0</span>                    <span class="token operator">|</span>
<span class="token operator">|</span> binlog_gtid_simple_recovery                <span class="token operator">|</span> <span class="token keyword">ON</span>                   <span class="token operator">|</span>
<span class="token operator">|</span> binlog_max_flush_queue_time                <span class="token operator">|</span> <span class="token number">0</span>                    <span class="token operator">|</span>
<span class="token operator">|</span> binlog_order_commits                       <span class="token operator">|</span> <span class="token keyword">ON</span>                   <span class="token operator">|</span>
<span class="token operator">|</span> binlog_row_image                           <span class="token operator">|</span> <span class="token keyword">FULL</span>                 <span class="token operator">|</span>
<span class="token operator">|</span> binlog_rows_query_log_events               <span class="token operator">|</span> <span class="token keyword">OFF</span>                  <span class="token operator">|</span>
<span class="token operator">|</span> binlog_stmt_cache_size                     <span class="token operator">|</span> <span class="token number">32768</span>                <span class="token operator">|</span>
<span class="token operator">|</span> binlog_transaction_dependency_history_size <span class="token operator">|</span> <span class="token number">25000</span>                <span class="token operator">|</span>
<span class="token operator">|</span> binlog_transaction_dependency_tracking     <span class="token operator">|</span> COMMIT_ORDER         <span class="token operator">|</span>
<span class="token operator">|</span> innodb_api_enable_binlog                   <span class="token operator">|</span> <span class="token keyword">OFF</span>                  <span class="token operator">|</span>
<span class="token operator">|</span> innodb_locks_unsafe_for_binlog             <span class="token operator">|</span> <span class="token keyword">OFF</span>                  <span class="token operator">|</span>
<span class="token operator">|</span> log_statements_unsafe_for_binlog           <span class="token operator">|</span> <span class="token keyword">ON</span>                   <span class="token operator">|</span>
<span class="token operator">|</span> max_binlog_cache_size                      <span class="token operator">|</span> <span class="token number">18446744073709547520</span> <span class="token operator">|</span>
<span class="token operator">|</span> max_binlog_size                            <span class="token operator">|</span> <span class="token number">1073741824</span>           <span class="token operator">|</span>
<span class="token operator">|</span> max_binlog_stmt_cache_size                 <span class="token operator">|</span> <span class="token number">18446744073709547520</span> <span class="token operator">|</span>
<span class="token operator">|</span> sync_binlog                                <span class="token operator">|</span> <span class="token number">1</span>                    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------------+----------------------+</span>
<span class="token number">22</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如图:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401151605712.png" alt="image-20240115160552654"></p><blockquote><p>(2) 进入&#x2F;var&#x2F;lib&#x2F;mysql 目录，查看 MySQL 生成的 binlog 文件</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment">#  cd /var/lib/mysql</span>
<span class="token punctuation">[</span>root@master mysql<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">188460</span>
-rw-r----- <span class="token number">1</span> mysql mysql       <span class="token number">56</span> Jan <span class="token number">11</span> <span class="token number">10</span>:14 auto.cnf
-rw-r----- <span class="token number">1</span> mysql mysql      <span class="token number">492</span> Jan <span class="token number">15</span> 08:04 ib_buffer_pool
-rw-r----- <span class="token number">1</span> mysql mysql <span class="token number">50331648</span> Jan <span class="token number">15</span> 08:04 ib_logfile0
-rw-r----- <span class="token number">1</span> mysql mysql <span class="token number">50331648</span> Jan <span class="token number">11</span> <span class="token number">10</span>:14 ib_logfile1
-rw-r----- <span class="token number">1</span> mysql mysql <span class="token number">79691776</span> Jan <span class="token number">15</span> 08:04 ibdata1
-rw-r----- <span class="token number">1</span> mysql mysql <span class="token number">12582912</span> Jan <span class="token number">15</span> 08:04 ibtmp1
drwxr-x--- <span class="token number">2</span> mysql mysql     <span class="token number">4096</span> Jan <span class="token number">13</span> 06:38 metastore
drwxr-x--- <span class="token number">2</span> mysql mysql     <span class="token number">4096</span> Jan <span class="token number">11</span> <span class="token number">10</span>:14 mysql
-rw-r----- <span class="token number">1</span> mysql mysql      <span class="token number">154</span> Jan <span class="token number">15</span> 08:04 mysql-bin.000001
-rw-r----- <span class="token number">1</span> mysql mysql       <span class="token number">19</span> Jan <span class="token number">15</span> 08:04 mysql-bin.index
srwxrwxrwx <span class="token number">1</span> mysql mysql        <span class="token number">0</span> Jan <span class="token number">15</span> 08:04 mysql.sock
-rw------- <span class="token number">1</span> mysql mysql        <span class="token number">5</span> Jan <span class="token number">15</span> 08:04 mysql.sock.lock
drwxr-x--- <span class="token number">2</span> mysql mysql     <span class="token number">4096</span> Jan <span class="token number">11</span> <span class="token number">10</span>:14 performance_schema
drwxr-x--- <span class="token number">2</span> mysql mysql    <span class="token number">12288</span> Jan <span class="token number">11</span> <span class="token number">10</span>:14 sys<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如图:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401151607695.png" alt="image-20240115160749637"></p><p>注：MySQL 生成的 binlog 文件<code>初始大小一定是 154 字节</code>，然后前缀是 log-bin 参数配 置的，后缀是默认从.000001，然后依次递增。除了 binlog 文件文件以外，MySQL 还会额外 生产一个.index 索引文件用来记录当前使用的 binlog 文件。</p><p>在数据库查看有几个binlog日志:</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">show</span> <span class="token keyword">binary</span> logs<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------+-----------+</span>
<span class="token operator">|</span> Log_name         <span class="token operator">|</span> File_size <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+-----------+</span>
<span class="token operator">|</span> mysql<span class="token operator">-</span>bin<span class="token punctuation">.</span><span class="token number">000001</span> <span class="token operator">|</span>       <span class="token number">154</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+-----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>查看当前在用的日志文件:</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">show</span> master <span class="token keyword">status</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------+----------+--------------+------------------+-------------------+</span>
<span class="token operator">|</span> <span class="token keyword">File</span>             <span class="token operator">|</span> Position <span class="token operator">|</span> Binlog_Do_DB <span class="token operator">|</span> Binlog_Ignore_DB <span class="token operator">|</span> Executed_Gtid_Set <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+----------+--------------+------------------+-------------------+</span>
<span class="token operator">|</span> mysql<span class="token operator">-</span>bin<span class="token punctuation">.</span><span class="token number">000001</span> <span class="token operator">|</span>      <span class="token number">154</span> <span class="token operator">|</span>              <span class="token operator">|</span>                  <span class="token operator">|</span>                   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+----------+--------------+------------------+-------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>查看二进制事件的功能：</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">show</span> binlog events <span class="token operator">in</span> <span class="token string">'mysql-bin.000001'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------+-----+----------------+-----------+-------------+---------------------------------------+</span>
<span class="token operator">|</span> Log_name         <span class="token operator">|</span> Pos <span class="token operator">|</span> Event_type     <span class="token operator">|</span> Server_id <span class="token operator">|</span> End_log_pos <span class="token operator">|</span> Info                                  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+-----+----------------+-----------+-------------+---------------------------------------+</span>
<span class="token operator">|</span> mysql<span class="token operator">-</span>bin<span class="token punctuation">.</span><span class="token number">000001</span> <span class="token operator">|</span>   <span class="token number">4</span> <span class="token operator">|</span> Format_desc    <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">123</span> <span class="token operator">|</span> Server ver: <span class="token number">5.7</span><span class="token number">.25</span><span class="token operator">-</span>log<span class="token punctuation">,</span> Binlog ver: <span class="token number">4</span> <span class="token operator">|</span>
<span class="token operator">|</span> mysql<span class="token operator">-</span>bin<span class="token punctuation">.</span><span class="token number">000001</span> <span class="token operator">|</span> <span class="token number">123</span> <span class="token operator">|</span> Previous_gtids <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">154</span> <span class="token operator">|</span>                                       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+-----+----------------+-----------+-------------+---------------------------------------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>详情笔记看:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401151614386.png" alt="image-20240115161151940"></p><h3 id="2-3-解压安装并重命名Maxwell"><a href="#2-3-解压安装并重命名Maxwell" class="headerlink" title="2.3 解压安装并重命名Maxwell"></a>2.3 解压安装并重命名Maxwell</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># tar -zxvf /opt/software/maxwell-1.29.0.tar.gz -C /opt/module/</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># mv /opt/module/maxwell-1.29.0/ /opt/module/maxwell</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-4-添加环境变量"><a href="#2-4-添加环境变量" class="headerlink" title="2.4 添加环境变量"></a>2.4 添加环境变量</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/profile</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>添加以下内容:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#maxwell</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">MAXWELL_HOME</span><span class="token operator">=</span>/opt/module/maxwell
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$MAXWELL_HOME</span>/bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="2-5-初始化-Maxwell-元数据库"><a href="#2-5-初始化-Maxwell-元数据库" class="headerlink" title="2.5 初始化 Maxwell 元数据库"></a>2.5 初始化 Maxwell 元数据库</h3><blockquote><p>（1）在 MySQL 中建立一个 maxwell 库用于存储 Maxwell 的元数据</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># mysql -uroot -p123456</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span>  <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> maxwell<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>（2）分配一个账号可以操作该数据库</p></blockquote><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">ON</span> maxwell<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'maxwell'</span><span class="token variable">@'%'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected<span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>(4) 分配这个账号可以监控其他数据库的权限</p></blockquote><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token punctuation">,</span><span class="token keyword">REPLICATION</span> SLAVE <span class="token punctuation">,</span> <span class="token keyword">REPLICATION</span> CLIENT <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> maxwell<span class="token variable">@'%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>(5）刷新 mysql 表权限</p></blockquote><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-6-Maxwell-进程启动"><a href="#2-6-Maxwell-进程启动" class="headerlink" title="2.6 Maxwell 进程启动"></a>2.6 Maxwell 进程启动</h3><p><strong>Maxwell 进程启动方式有如下两种：</strong></p><blockquote><p>（1）使用命令行参数启动 Maxwell 进程</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">maxwell <span class="token parameter variable">--user</span><span class="token operator">=</span><span class="token string">'maxwell'</span> <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token string">'123456'</span> <span class="token parameter variable">--host</span><span class="token operator">=</span><span class="token string">'master'</span> <span class="token parameter variable">--producer</span><span class="token operator">=</span>stdout
maxwell <span class="token parameter variable">--user</span><span class="token operator">=</span><span class="token string">'root'</span> <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token string">'123456'</span> <span class="token parameter variable">--host</span><span class="token operator">=</span><span class="token string">'master'</span> <span class="token parameter variable">--producer</span><span class="token operator">=</span>stdout<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>参数解释:</p><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>–user</td><td>连接 mysql 的用户</td></tr><tr><td>–password</td><td>连接 mysql 的用户的密码</td></tr><tr><td>–host</td><td>安装的主机名</td></tr><tr><td>–producer</td><td>生产者模式(stdout：控制台 kafka：kafka 集群)</td></tr></tbody></table><blockquote><p>（2）修改配置文件，定制化启动 Maxwell 进程</p></blockquote><p>拷贝一份原配置文档：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cd $MAXWELL_HOME/</span>
<span class="token punctuation">[</span>root@master maxwell-1.29.0<span class="token punctuation">]</span><span class="token comment"># cp config.properties.example config.properties</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>修改如下:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#默认就好</span>
<span class="token assign-left variable">log_level</span><span class="token operator">=</span>info
<span class="token assign-left variable">producer</span><span class="token operator">=</span>kafka

<span class="token comment"># kafka的ip以及端口配置,修改成自己的,这里改成了集群模式,也可使用默认的单节点模式</span>
<span class="token assign-left variable">kafka.bootstrap.servers</span><span class="token operator">=</span>master:9092,slave1:9092,slave2:9092

<span class="token comment">#mysql登录信息</span>
<span class="token assign-left variable">host</span><span class="token operator">=</span>localhost
<span class="token assign-left variable">user</span><span class="token operator">=</span>maxwell
<span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token number">123456</span>
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">3306</span>

<span class="token comment">#kafka的主题配置</span>
<span class="token assign-left variable">kafka_topic</span><span class="token operator">=</span>maxwell<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th align="center"><strong>配置选项</strong></th><th align="center"><strong>配置说明</strong></th></tr></thead><tbody><tr><td align="center">producer&#x3D;kafka</td><td align="center">实时监控到的日志发送到kafka生产者</td></tr><tr><td align="center">kafka.bootstrap.servers&#x3D;localhost:9092</td><td align="center">配置的本地kafka节点IP地址以及端口号，kafka默认端口号9092</td></tr><tr><td align="center">host&#x3D;xx.xx.xx.xx</td><td align="center">本地Mysql安装节点IP地址</td></tr><tr><td align="center">user&#x3D;*******</td><td align="center">用户名</td></tr><tr><td align="center">password&#x3D;******</td><td align="center">用户密码（按照自己设置输入）</td></tr><tr><td align="center">kafka_topic&#x3D;kafka</td><td align="center">实时监控到的日志数据发送kafkaTopic下（默认发送maxwell）</td></tr><tr><td align="center">include_dbs&#x3D;test</td><td align="center">过滤除test数据库下所有日志数据</td></tr><tr><td align="center">include_tables&#x3D;表名,表名</td><td align="center">可以指定不需要过滤日志数据的表名</td></tr></tbody></table><p>修改结果:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401151656999.png" alt="image-20240115165606920"></p><h3 id="2-7-启动测试"><a href="#2-7-启动测试" class="headerlink" title="2.7 启动测试"></a>2.7 启动测试</h3><blockquote><p>启动kafka集群 <strong>（maxwell运行需要先启动kafka）</strong></p></blockquote><p><strong>先启动zookeeper服务:</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">方式1:启动zookeeper（kafka自带）
<span class="token punctuation">[</span>root@master kafka<span class="token punctuation">]</span><span class="token comment"># zookeeper-server-start.sh -daemon config/zookeeper.properties</span>

方式2:启动zookeeper集群<span class="token punctuation">(</span>推荐<span class="token punctuation">)</span>
<span class="token comment">#所有节点启动zookeeper服务</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># zkServer.sh start</span>

<span class="token comment">#启动kafka</span>
<span class="token punctuation">[</span>root@master kafka<span class="token punctuation">]</span><span class="token comment"># kafka-server-start.sh -daemon $KAFKA_HOME/config/server.properties</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>所有节点启动kafka服务:</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kafka-server-start.sh -daemon $KAFKA_HOME/config/server.properties</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看进程是否启动成功:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401151714671.png" alt="image-20240115171438607"></p><blockquote><p>使用kakfa创建一个topic</p></blockquote><p>创建的<code>topic名称要与config.properties配置的一致</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">kafka-topics.sh <span class="token parameter variable">--create</span> <span class="token parameter variable">--zookeeper</span> master:2181,slave1:2181,slave2:2181 --replication-factor <span class="token number">1</span> <span class="token parameter variable">--partitions</span> <span class="token number">1</span> <span class="token parameter variable">--topic</span> maxwell<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看创建的topic:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --list --zookeeper localhost:2181 | grep maxwell</span>
maxwell<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401151951192.png" alt="image-20240115195102043"></p><blockquote><p>启动maxwell测试</p></blockquote><p>启动命令：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># maxwell -conf $MAXWELL_HOME/config.properties</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>启动成功：<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401151952776.png" alt="image-20240115195239663"></p><h2 id="3-Maxwell入门案例"><a href="#3-Maxwell入门案例" class="headerlink" title="3. Maxwell入门案例"></a>3. Maxwell入门案例</h2><h3 id="3-1-监控-Mysql-数据并在控制台打印"><a href="#3-1-监控-Mysql-数据并在控制台打印" class="headerlink" title="3.1 监控 Mysql 数据并在控制台打印"></a>3.1 监控 Mysql 数据并在控制台打印</h3><blockquote><p>(1) 运行Maxwell来监控MySQL数据更新</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">maxwell <span class="token parameter variable">--user</span><span class="token operator">=</span><span class="token string">'maxwell'</span> <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token string">'123456'</span> <span class="token parameter variable">--host</span><span class="token operator">=</span><span class="token string">'master'</span> <span class="token parameter variable">--producer</span><span class="token operator">=</span>stdout<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>(2) 向 mysql 的 test_maxwell 库的 test 表插入一条数据，查看 maxwell 的控制台输出</p></blockquote><p>在MySQL创建一个 test_maxwell的数据库:</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> test_maxwell<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>创建表:</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">use</span> test_maxwell<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> test <span class="token punctuation">(</span>
    id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    field1 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    field2 <span class="token keyword">INT</span><span class="token punctuation">,</span>
    field3 <span class="token keyword">FLOAT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>插入一条数据:</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test <span class="token punctuation">(</span>field1<span class="token punctuation">,</span> field2<span class="token punctuation">,</span> field3<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'value1'</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">45.67</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看 maxwell 的控制台输出:</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"database"</span><span class="token operator">:</span> <span class="token string">"test_maxwell"</span><span class="token punctuation">,</span>		--库名
	<span class="token property">"table"</span><span class="token operator">:</span> <span class="token string">"test"</span><span class="token punctuation">,</span>				--表名
	<span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"insert"</span><span class="token punctuation">,</span>				--数据更新类型
	<span class="token property">"ts"</span><span class="token operator">:</span> <span class="token number">1705321149</span><span class="token punctuation">,</span>				--操作时间
	<span class="token property">"xid"</span><span class="token operator">:</span> <span class="token number">7202</span><span class="token punctuation">,</span>					--操作 id
	<span class="token property">"commit"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>					--提交成功
	<span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>						--数据
		<span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token property">"field1"</span><span class="token operator">:</span> <span class="token string">"value1"</span><span class="token punctuation">,</span>
		<span class="token property">"field2"</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
		<span class="token property">"field3"</span><span class="token operator">:</span> <span class="token number">45.67</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果如图:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401152021461.png" alt="image-20240115202135388"></p><blockquote><p>(3) 向 mysql 的 test_maxwell 库的 test 表同时插入 3 条数据，控制台出现了 3 条 json 日志，说明 maxwell 是以数据行为单位进行日志的采集的。</p></blockquote><p>插入数据:</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test <span class="token punctuation">(</span>field1<span class="token punctuation">,</span> field2<span class="token punctuation">,</span> field3<span class="token punctuation">)</span> <span class="token keyword">VALUES</span>
    <span class="token punctuation">(</span><span class="token string">'value2'</span><span class="token punctuation">,</span> <span class="token number">456</span><span class="token punctuation">,</span> <span class="token number">89.12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'value4'</span><span class="token punctuation">,</span> <span class="token number">789</span><span class="token punctuation">,</span> <span class="token number">12.34</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'value5'</span><span class="token punctuation">,</span> <span class="token number">900</span><span class="token punctuation">,</span> <span class="token number">13.34</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>插入数据后出现3条json日志,说明 maxwell 是以数据行为单位进行日志的采集的:</p><p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401152028590.png" alt="image-20240115202815495"></p><blockquote><p>（4）修改 test_maxwell 库的 test 表的一条数据，查看 maxwell 的控制台输出</p></blockquote><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">update</span> test <span class="token keyword">set</span> field3<span class="token operator">=</span><span class="token string">'6666'</span> <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Maxwell控制台输出:</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"database"</span><span class="token operator">:</span> <span class="token string">"test_maxwell"</span><span class="token punctuation">,</span>
	<span class="token property">"table"</span><span class="token operator">:</span> <span class="token string">"test"</span><span class="token punctuation">,</span>
	<span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"update"</span><span class="token punctuation">,</span>			--更新数据
	<span class="token property">"ts"</span><span class="token operator">:</span> <span class="token number">1705325669</span><span class="token punctuation">,</span>
	<span class="token property">"xid"</span><span class="token operator">:</span> <span class="token number">18689</span><span class="token punctuation">,</span>
	<span class="token property">"commit"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
		<span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token property">"field1"</span><span class="token operator">:</span> <span class="token string">"value1"</span><span class="token punctuation">,</span>
		<span class="token property">"field2"</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
		<span class="token property">"field3"</span><span class="token operator">:</span> <span class="token number">6666.0</span>		--修改后的数据
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	<span class="token property">"old"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
		<span class="token property">"field3"</span><span class="token operator">:</span> <span class="token number">45.67</span>			--修改前的数据
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>（5）删除 test_maxwell 库的 test 表的一条数据，查看 maxwell 的控制台输出</p></blockquote><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">delete</span> <span class="token keyword">from</span> test <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Maxwell控制台输出:</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"database"</span><span class="token operator">:</span> <span class="token string">"test_maxwell"</span><span class="token punctuation">,</span>
	<span class="token property">"table"</span><span class="token operator">:</span> <span class="token string">"test"</span><span class="token punctuation">,</span>
	<span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"delete"</span><span class="token punctuation">,</span>			--删除数据
	<span class="token property">"ts"</span><span class="token operator">:</span> <span class="token number">1705326034</span><span class="token punctuation">,</span>
	<span class="token property">"xid"</span><span class="token operator">:</span> <span class="token number">19617</span><span class="token punctuation">,</span>
	<span class="token property">"commit"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
		<span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token property">"field1"</span><span class="token operator">:</span> <span class="token string">"value1"</span><span class="token punctuation">,</span>
		<span class="token property">"field2"</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
		<span class="token property">"field3"</span><span class="token operator">:</span> <span class="token number">6666.0</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-2-监控-Mysql-数据输出到-kafka"><a href="#3-2-监控-Mysql-数据输出到-kafka" class="headerlink" title="3.2 监控 Mysql 数据输出到 kafka"></a>3.2 监控 Mysql 数据输出到 kafka</h3><blockquote><p>(1) 实现步骤</p></blockquote><p>:one:启动zookeeper 和 kafka服务</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#所有节点启动zookeeper服务</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># zkServer.sh start</span>

<span class="token comment">#启动kafka</span>
<span class="token punctuation">[</span>root@master kafka<span class="token punctuation">]</span><span class="token comment"># kafka-server-start.sh -daemon $KAFKA_HOME/config/server.properties</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401152144489.png" alt="image-20240115214422400"></p><p>:two:启动 Maxwell 监控 binlog</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">maxwell <span class="token parameter variable">--user</span><span class="token operator">=</span><span class="token string">'maxwell'</span> <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token string">'123456'</span> <span class="token parameter variable">--host</span><span class="token operator">=</span><span class="token string">'master'</span> <span class="token parameter variable">--producer</span><span class="token operator">=</span>kafka <span class="token parameter variable">--kafka.bootstrap.servers</span><span class="token operator">=</span>master:9092 <span class="token parameter variable">--kafka_topic</span><span class="token operator">=</span>maxwell<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>参数详解:</strong></p><ol><li><code>--user=&#39;maxwell&#39;</code>: 指定连接 MySQL 数据库时使用的用户名，这里设置为 “maxwell”。</li><li><code>--password=&#39;123456&#39;</code>: 指定连接 MySQL 数据库时使用的密码，这里设置为 “123456”。请注意，直接在命令行中明文指定密码可能存在安全风险，最好是在安全环境下使用。</li><li><code>--host=&#39;master&#39;</code>: 指定连接 MySQL 数据库的主机名或 IP 地址，这里设置为 “master”。</li><li><code>--producer=kafka</code>: 指定 Maxwell 数据库复制工具使用的消息队列类型，这里设置为 Kafka。</li><li><code>--kafka.bootstrap.servers=master:9092</code>: 指定连接 Kafka 服务的地址，这里设置为 “master:9092”，表示 Kafka 服务运行在主机 “master” 上，端口为 “9092”。</li><li><code>--kafka_topic=maxwell</code>: 指定 Maxwell 数据写入 Kafka 时使用的主题名称，这里设置为 “maxwell”。</li></ol><p>这个命令的作用是使用 Maxwell 工具连接到 MySQL 数据库（使用指定的用户名、密码、主机），并将数据库变更的消息写入 Kafka 中的指定主题。</p><p>:three:打开 kafka 的控制台的消费者消费 maxwell 主题</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kafka-console-consumer.sh --bootstrap-server master:9092 --topic maxwell</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>:four:向 test_maxwell 库的 test 表再次插入一条数据</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test <span class="token punctuation">(</span>field1<span class="token punctuation">,</span> field2<span class="token punctuation">,</span> field3<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'value1'</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">45.67</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>:five:通过 kafka 消费者来查看到了数据，说明数据成功传入 kafka</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span><span class="token string">"database"</span><span class="token builtin class-name">:</span><span class="token string">"test_maxwell"</span>,<span class="token string">"table"</span><span class="token builtin class-name">:</span><span class="token string">"test"</span>,<span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"insert"</span>,<span class="token string">"ts"</span>:1705326915,<span class="token string">"xid"</span>:20783,<span class="token string">"commit"</span>:true,<span class="token string">"data"</span>:<span class="token punctuation">&#123;</span><span class="token string">"id"</span>:5,<span class="token string">"field1"</span><span class="token builtin class-name">:</span><span class="token string">"value1"</span>,<span class="token string">"field2"</span>:123,<span class="token string">"field3"</span>:45.67<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401152156329.png" alt="image-20240115215652257"></p><blockquote><p>(2) kafka 主题数据的分区控制</p></blockquote><p>​	在公司生产环境中，我们一般都会用 maxwell 监控多个 mysql 库的数据，然后将这 些数据发往 kafka 的一个主题 Topic，并且这个主题也肯定是多分区的，为了提高并发度。 那么如何控制这些数据的分区问题，就变得至关重要，实现步骤如下：</p><p>:one:修改 maxwell 的配置文件，定制化启动 maxwell 进程</p><p>备份之前修改的配置文件:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cp $MAXWELL_HOME/config.properties $MAXWELL_HOME/config.properties.bak</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>再对配置文件进行修改:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># vim $MAXWELL_HOME/config.properties</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>添加此项配置并修改topic为<code>maxwell3</code>:</p><p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401152228496.png" alt="image-20240115222836423"></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">kafka_topic</span><span class="token operator">=</span>maxwell3
<span class="token assign-left variable">producer_partition_by</span><span class="token operator">=</span>database<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>参数解释:</strong></p><p><code>producer_partition_by=database</code> 是 Maxwell 配置中的一个参数，用于指定在将数据库变更写入 Kafka 主题时如何进行分区。在这里，<code>producer_partition_by</code> 设置为 “database”，表示按照数据库进行分区。</p><p>完整配置如下:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># grep -Ev "^$|^#" $MAXWELL_HOME/config.properties</span>
<span class="token assign-left variable">log_level</span><span class="token operator">=</span>info
<span class="token assign-left variable">producer</span><span class="token operator">=</span>kafka
<span class="token assign-left variable">kafka.bootstrap.servers</span><span class="token operator">=</span>master:9092,slave1:9092,slave2:9092
<span class="token assign-left variable">host</span><span class="token operator">=</span>localhost
<span class="token assign-left variable">user</span><span class="token operator">=</span>maxwell
<span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token number">123456</span>
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">3306</span>
<span class="token assign-left variable">kafka_topic</span><span class="token operator">=</span>maxwell3
<span class="token assign-left variable">kafka.compression.type</span><span class="token operator">=</span>snappy
<span class="token assign-left variable">kafka.retries</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">kafka.acks</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">producer_partition_by</span><span class="token operator">=</span>database<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>:two:手动创建一个 3 个分区的 topic，名字就叫做 <code>maxwell3</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">kafka-topics.sh <span class="token parameter variable">--create</span> <span class="token parameter variable">--zookeeper</span> master:2181,slave1:2181,slave2:2181 --replication-factor <span class="token number">2</span> <span class="token parameter variable">--partitions</span> <span class="token number">3</span> <span class="token parameter variable">--topic</span> maxwell3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看创建的topic:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --list --zookeeper master:2181 | grep maxwell3</span>
maxwell3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>:three:利用配置文件启动Maxwell进程</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># maxwell --config $MAXWELL_HOME/config.properties</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>启动成功截图:<img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401152238790.png" alt="image-20240115223852700"></p><p>:four:向 test_maxwell 库的 test 表再次插入一条数据</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test <span class="token punctuation">(</span>field1<span class="token punctuation">,</span> field2<span class="token punctuation">,</span> field3<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'value6'</span><span class="token punctuation">,</span> <span class="token number">666</span><span class="token punctuation">,</span> <span class="token number">66.66</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>:two:通过 kafka tool 工具查看，此条数据进入了 maxwell3 主题的 1 号分区</p><p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401161103898.png" alt="image-20240116110302785"></p><p>:six:向 test 库的 aaa 表插入一条数据</p><p>创建aaa表:</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">use</span> test_maxwell<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> aaa <span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span> name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token punctuation">,</span>old <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>向aaa表插入数据:</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> aaa <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> old<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"hj"</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> aaa <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> old<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"ggg"</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>可以看出数据全部进入了maxwell3 主题的 1号分区</p><p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401161130001.png" alt="image-20240116113004898"></p><h3 id="3-3-监控-Mysql-指定表数据输出控制台"><a href="#3-3-监控-Mysql-指定表数据输出控制台" class="headerlink" title="3.3 监控 Mysql 指定表数据输出控制台"></a>3.3 监控 Mysql 指定表数据输出控制台</h3><blockquote><p>(1) 运行 maxwell 来监控 mysql 指定表数据更新</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">maxwell <span class="token parameter variable">--user</span><span class="token operator">=</span><span class="token string">'maxwell'</span> <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token string">'123456'</span> <span class="token parameter variable">--host</span><span class="token operator">=</span><span class="token string">'master'</span> <span class="token parameter variable">--filter</span> <span class="token string">'exclude: *.*, include:test_maxwell.test'</span> <span class="token parameter variable">--producer</span><span class="token operator">=</span>stdout<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>参数详解:</strong></p><ol><li><p><code>--user=&#39;maxwell&#39;</code>: 指定连接 MySQL 数据库时使用的用户名，这里设置为 “maxwell”。</p></li><li><p><code>--password=&#39;123456&#39;</code>: 指定连接 MySQL 数据库时使用的密码，这里设置为 “123456”。请注意，直接在命令行中明文指定密码可能存在安全风险，最好是在安全环境下使用。</p></li><li><p><code>--host=&#39;master&#39;</code>: 指定连接 MySQL 数据库的主机名或 IP 地址，这里设置为 “master”。</p></li><li><p><code>--filter &#39;exclude: *.*, include:test_maxwell.test&#39;</code>: 用于配置 Maxwell 数据库复制工具的过滤规则。在这里，设置了两个规则：</p><ul><li><code>exclude: *.*</code>: 排除所有的数据库表。</li><li><code>include:test_maxwell.test</code>: 包含名为 “test_maxwell” 数据库中的 “test” 表。</li></ul><p>这样的过滤规则指定了哪些数据库和表的变更会被捕获和传输，以及哪些会被排除。</p></li><li><p><code>--producer=stdout</code>: 指定 Maxwell 数据库复制工具的消息生产者（用于发送消息的模块），这里设置为 “stdout”，表示将变更事件输出到标准输出。</p></li></ol><blockquote><p>(2) 向 test_maxwell.test 表插入一条数据，查看 maxwell 的监控</p></blockquote><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_maxwell<span class="token punctuation">.</span>test <span class="token punctuation">(</span>field1<span class="token punctuation">,</span> field2<span class="token punctuation">,</span> field3<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'value10'</span><span class="token punctuation">,</span> <span class="token number">989</span><span class="token punctuation">,</span> <span class="token number">18.88</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看maxwll监控:</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"database"</span><span class="token operator">:</span><span class="token string">"test_maxwell"</span><span class="token punctuation">,</span><span class="token property">"table"</span><span class="token operator">:</span><span class="token string">"test"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"insert"</span><span class="token punctuation">,</span><span class="token property">"ts"</span><span class="token operator">:</span><span class="token number">1705376235</span><span class="token punctuation">,</span><span class="token property">"xid"</span><span class="token operator">:</span><span class="token number">38715</span><span class="token punctuation">,</span><span class="token property">"commit"</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">"data"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"id"</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token property">"field1"</span><span class="token operator">:</span><span class="token string">"value10"</span><span class="token punctuation">,</span><span class="token property">"field2"</span><span class="token operator">:</span><span class="token number">989</span><span class="token punctuation">,</span><span class="token property">"field3"</span><span class="token operator">:</span><span class="token number">18.88</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>(3) 向 test_maxwell.aaa 表插入一条数据，查看 maxwell 的监控</p></blockquote><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_maxwell<span class="token punctuation">.</span>aaa <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> old<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"gxjzy"</span><span class="token punctuation">,</span><span class="token number">289</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看maxwell监控:</p><p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401161139932.png" alt="image-20240116113940847"></p><p>本次maxwell控制台没有收到任何信息 说明 <code>include</code>参数生效，<code>只能监控指定的 mysql 表的信息</code></p><p>​	<strong>还可以设置 <code>include:test_maxwell.*</code>，通过此种方式来<code>监控 mysql 某个库的所有 表</code>，也就是说过滤整个库。可以自行测试,同理</strong></p><h3 id="3-4-监控-Mysql-指定表全量数据输出控制台，数据初始化"><a href="#3-4-监控-Mysql-指定表全量数据输出控制台，数据初始化" class="headerlink" title="3.4 监控 Mysql 指定表全量数据输出控制台，数据初始化"></a>3.4 监控 Mysql 指定表全量数据输出控制台，数据初始化</h3><p>​	Maxwell 进程默认只能监控 mysql 的 binlog 日志的新增及变化的数据，但是 Maxwell 是支持数据初始化的，可以通过修改 Maxwell 的元数据，来对 MySQL 的某张表 进行数据初始化，也就是我们常说的全量同步。具体操作步骤如下：</p><p>​</p><p>需求：将 test_maxwell 库下的 aaa表的3条数据，全量导入到 maxwell 控制台 进行打印。</p><p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401161455066.png" alt="image-20240116145537979"></p><blockquote><p>(1) 修改 Maxwell 的元数据，触发数据初始化机制，<code>在 mysql 的 maxwell 库中 bootstrap 表中插入一条数据</code>，<code>写明</code>需要全量数据的<code>库名和表名</code>。</p></blockquote><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> maxwell<span class="token punctuation">.</span>bootstrap<span class="token punctuation">(</span>database_name<span class="token punctuation">,</span>table_name<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'test_maxwell'</span><span class="token punctuation">,</span><span class="token string">'aaa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401161510648.png" alt="image-20240116151002580"></p><blockquote><p>(2) 启动 maxwell 进程，此时初始化程序会直接打印 <code>aaa 表</code>的所有数据</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">maxwell <span class="token parameter variable">--user</span><span class="token operator">=</span><span class="token string">'maxwell'</span> <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token string">'123456'</span> <span class="token parameter variable">--host</span><span class="token operator">=</span><span class="token string">'master'</span> <span class="token parameter variable">--producer</span><span class="token operator">=</span>stdout<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401161501100.png" alt="image-20240116150101019"></p><blockquote><p>(3) 当数据全部初始化完成以后，Maxwell 的元数据会变化</p></blockquote><ul><li>is_complete 字段从 0 变为 1</li><li>start_at 字段从 null 变为具体时间(数据同步开始时间)</li><li>complete_at 字段从 null 变为具体时间(数据同步结束时间)</li></ul><p><img src="https://hj-typora-images-1319512400.cos.ap-guangzhou.myqcloud.com/images/202401161511898.png" alt="image-20240116151138819"></p><p>完成</p></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者: </i></span><span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">無以菱</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接: </i></span><span class="reprint-info"><a href="https://www.wylblog.cn/2024/11/27/maxwell-pei-zhi/">https://www.wylblog.cn/2024/11/27/maxwell-pei-zhi/</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明: </i></span><span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/about" target="_blank">無以菱</a> !</span></div></div><script async defer>function navToReprintStatement(){$("html, body").animate({scrollTop:$("#reprint-statement").offset().top-80},800)}document.addEventListener("copy",function(t){M.toast({html:'<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>'})})</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/Bigdata/"><span class="chip bg-color">Bigdata</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="qq,qzone,wechat,weibo" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="/libs/share/js/social-share.min.js"></script></div></div></div><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="/medias/wylblog/alipay.webp" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="/medias/wylblog/wechat.webp" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><style>.valine-card{margin:1.5rem auto}.valine-card .card-content{padding:20px 20px 5px 20px}#vcomments textarea{box-sizing:border-box;background:url(/medias/comment_bg.png) 100% 100% no-repeat}#vcomments p{margin:2px 2px 10px;font-size:1.05rem;line-height:1.78rem}#vcomments blockquote p{text-indent:.2rem}#vcomments a{padding:0 2px;color:#4cbf30;font-weight:500;text-decoration:none}#vcomments img{max-width:100%;height:auto;cursor:pointer}#vcomments ol li{list-style-type:decimal}#vcomments ol,ul{display:block;padding-left:2em;word-spacing:.05rem}#vcomments ul li,ol li{display:list-item;line-height:1.8rem;font-size:1rem}#vcomments ul li{list-style-type:disc}#vcomments ul ul li{list-style-type:circle}#vcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}#vcomments table,td,th{border:0}table tr:nth-child(2n),thead{background-color:#fafafa}#vcomments table th{background-color:#f2f2f2;min-width:80px}#vcomments table td{min-width:80px}#vcomments h1{font-size:1.85rem;font-weight:700;line-height:2.2rem}#vcomments h2{font-size:1.65rem;font-weight:700;line-height:1.9rem}#vcomments h3{font-size:1.45rem;font-weight:700;line-height:1.7rem}#vcomments h4{font-size:1.25rem;font-weight:700;line-height:1.5rem}#vcomments h5{font-size:1.1rem;font-weight:700;line-height:1.4rem}#vcomments h6{font-size:1rem;line-height:1.3rem}#vcomments p{font-size:1rem;line-height:1.5rem}#vcomments hr{margin:12px 0;border:0;border-top:1px solid #ccc}#vcomments blockquote{margin:15px 0;border-left:5px solid #42b983;padding:1rem .8rem .3rem .8rem;color:#666;background-color:rgba(66,185,131,.1)}#vcomments pre{font-family:monospace,monospace;padding:1.2em;margin:.5em 0;background:#272822;overflow:auto;border-radius:.3em;tab-size:4}#vcomments code{font-family:monospace,monospace;padding:1px 3px;font-size:.92rem;color:#e96900;background-color:#f8f8f8;border-radius:2px}#vcomments pre code{font-family:monospace,monospace;padding:0;color:#e8eaf6;background-color:#272822}#vcomments pre[class*=language-]{padding:1.2em;margin:.5em 0}#vcomments code[class*=language-],pre[class*=language-]{color:#e8eaf6}#vcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}#vcomments b,strong{font-weight:700}#vcomments dfn{font-style:italic}#vcomments small{font-size:85%}#vcomments cite{font-style:normal}#vcomments mark{background-color:#fcf8e3;padding:.2em}#vcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}table tr:nth-child(2n),thead{background-color:#fafafa}#vcomments table th{background-color:#f2f2f2;min-width:80px}#vcomments table td{min-width:80px}#vcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}</style><div class="card valine-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="vcomments" class="card-content" style="display:grid"></div></div><script src="/libs/valine/av-min.js"></script><script src="/libs/valine/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"Mte7fae2id8Jx9bKn48B0kdJ-gzGzoHsz",appKey:"RW87hMrhzc4zeYx3QkqSsIGr",serverURLs:"https://Mte7fae2.lc-cn-n1-shared.com",notify:!1,verify:!1,visitor:!0,avatar:"hide",pageSize:"10",lang:"zh-cn",placeholder:"留言请走心，不然小菱会生气哦~,Your thoughts, your stage 🎤"})</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i>&nbsp;上一篇</div><div class="card"><a href="/2024/11/27/flume-pei-zhi-1-9-0/"><div class="card-image"><img src="/medias/featureimages/12.webp" class="responsive-img" alt="Flume配置(1.9.0)和基本使用"> <span class="card-title">Flume配置(1.9.0)和基本使用</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2024-11-27 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E8%BF%90%E7%BB%B4%E7%B3%BB%E5%88%97/" class="post-category">大数据运维系列</a></span></div></div><div class="card-action article-tags"><a href="/tags/Bigdata/"><span class="chip bg-color">Bigdata</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/2024/11/27/go-yu-yan-zhong-de-shu-ju-lei-xing/"><div class="card-image"><img src="/medias/featureimages/0.webp" class="responsive-img" alt="Go语言中的数据类型"> <span class="card-title">Go语言中的数据类型</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2024-11-27 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/" class="post-category">运维开发</a></span></div></div><div class="card-action article-tags"><a href="/tags/Golang/"><span class="chip bg-color">Golang</span></a></div></div></div></div></article></div><script>$("#articleContent").on("copy",function(e){var n,t,o,i;void 0===window.getSelection||(""+(n=window.getSelection())).length<Number.parseInt("200")||(t=document.getElementsByTagName("body")[0],(o=document.createElement("div")).style.position="absolute",o.style.left="-99999px",t.appendChild(o),o.appendChild(n.getRangeAt(0).cloneContents()),"PRE"!==n.getRangeAt(0).commonAncestorContainer.nodeName&&"CODE"!==n.getRangeAt(0).commonAncestorContainer.nodeName||(o.innerHTML="<pre>"+o.innerHTML+"</pre>"),i=document.location.href,o.innerHTML+='<br />来源: WuYiling&#39; Blog<br />文章作者: 無以菱<br />文章链接: <a href="'+i+'">'+i+"</a><br />本文章著作权归作者所有，任何形式的转载都请注明出处。",n.selectAllChildren(o),window.setTimeout(function(){t.removeChild(o)},200))})</script><script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script><script type="text/javascript" src="/libs/prism/prism.min.js"></script><script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script><script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script><script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget card" style="background-color:#fff"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="/libs/tocbot/tocbot.min.js"></script><script>$(function(){tocbot.init({tocSelector:"#toc-content",contentSelector:"#articleContent",headingsOffset:-(.4*$(window).height()-45),collapseDepth:Number("0"),headingSelector:"h2, h3, h4"});let t=parseInt(.4*$(window).height()-64),e=$(".toc-widget"),n=($(window).scroll(function(){$(window).scrollTop()>t?e.addClass("toc-fixed"):e.removeClass("toc-fixed")}),"expanded"),i=$("#toc-aside"),l=$("#main-content");$("#floating-toc-btn .btn-floating").click(function(){i.hasClass(n)?(i.removeClass(n).hide(),l.removeClass("l9")):(i.addClass(n).show(),l.addClass("l9"));var e="artDetail",o="prenext-posts";if(0!==(e=$("#"+e)).length){let t=e.width();450<=t?t+=21:350<=t&&t<450?t+=18:300<=t&&t<350?t+=16:t+=14,$("#"+o).width(t)}})})</script></main><footer class="page-footer bg-color"><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2024</span> <a href="/about" target="_blank">無以菱</a> |&nbsp;每天进步一点点&nbsp;<a href="/about" target="_blank">(=ＴェＴ=)挨骂</a> |&nbsp;永远支持&nbsp;<a href="https://m.weibo.cn/u/3179885602" target="_blank">ZCY</a><br>&nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span class="white-color">65.5k</span> <span id="busuanzi_container_site_pv">&nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp; <span id="busuanzi_value_site_pv" class="white-color"></span> </span><span id="busuanzi_container_site_uv">&nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp; <span id="busuanzi_value_site_uv" class="white-color"></span></span><br><span id="sitetime">Loading...</span><script>var seconds=1e3,minutes=60*seconds,hours=60*minutes,days=24*hours,calcSiteTime=function(){function e(){var e=new Date-a,s=Math.floor(e/days),n=Math.floor(e%days/hours),t=Math.floor(e%hours/minutes),e=Math.floor(e%minutes/seconds),o=`This site has been running for ${s} days ${n} hours ${t} minutes ${e} seconds.`,o=`<i class="fa-solid fa-rocket"></i>本站居然已经运行 ${s} 天 ${n} 小时 ${t} 分 ${e} 秒，如果出问题，那肯定是缓存的锅！`;document.getElementById("sitetime").innerHTML=o}var a=new Date("2024",9,"13","0","0","0");e(),setInterval(e,1e3)};calcSiteTime()</script><br></div><div class="col s12 m4 l4 social-link social-statis"></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script type="text/javascript">$(function(){var e,r,s;e="/search.xml",r="searchInput",s="searchResult",$.ajax({url:e,dataType:"xml",success:function(e){var t=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),e=document.getElementById(r),n=document.getElementById(s);e.addEventListener("input",function(){var o='<ul class="search-result-list">',h=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length<=0||(t.forEach(function(e){var n,t,r,s=!0,a=e.title.trim().toLowerCase(),l=e.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),i=0===(i=e.url).indexOf("/")?e.url:"/"+i,c=-1,u=-1;""!==a&&""!==l&&h.forEach(function(e,t){n=a.indexOf(e),c=l.indexOf(e),n<0&&c<0?s=!1:(c<0&&(c=0),0===t&&(u=c))}),s&&(o+="<li><a href='"+i+"' class='search-result-title'>"+a+"</a>",i=e.content.trim().replace(/<[^>]+>/g,""),0<=u&&(e=u+80,(e=0===(t=(t=u-20)<0?0:t)?100:e)>i.length&&(e=i.length),r=i.substr(t,e),h.forEach(function(e){var t=new RegExp(e,"gi");r=r.replace(t,'<em class="search-keyword">'+e+"</em>")}),o+='<p class="search-result">'+r+"...</p>"),o+="</li>")}),o+="</ul>",n.innerHTML=o)})}})})</script><div class="stars-con"><div id="stars"></div><div id="stars2"></div><div id="stars3"></div></div><script>function switchNightMode(){$('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($("body")),setTimeout(function(){$("body").hasClass("DarkMode")?($("body").removeClass("DarkMode"),localStorage.setItem("isDark","0"),$("#sum-moon-icon").removeClass("fa-sun").addClass("fa-moon")):($("body").addClass("DarkMode"),localStorage.setItem("isDark","1"),$("#sum-moon-icon").addClass("fa-sun").removeClass("fa-moon")),setTimeout(function(){$(".Cuteen_DarkSky").fadeOut(1e3,function(){$(this).remove()})},2e3)})}</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="/libs/materialize/materialize.min.js"></script><script src="/libs/masonry/masonry.pkgd.min.js"></script><script src="/libs/aos/aos.js"></script><script src="/libs/scrollprogress/scrollProgress.min.js"></script><script src="/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="/js/matery.js"></script><script src="https://ssl.captcha.qq.com/TCaptcha.js"></script><script src="/libs/others/TencentCaptcha.js"></script><button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button><script>(()=>{var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",(e=document.getElementsByTagName("script")[0]).parentNode.insertBefore(t,e)})()</script><script src="/libs/others/clicklove.js" async></script><script async src="/libs/others/busuanzi.pure.mini.js"></script><script type="text/javascript" color="0,0,255" pointcolor="0,0,255" opacity="0.7" zindex="-1" count="99" src="/libs/background/canvas-nest.js"></script><script src="/libs/instantpage/instantpage.js" type="module"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"><script src="https://cdn.jsdelivr.net/gh/17lai/live2d-widget@latest/autoload.js"></script></body></html>